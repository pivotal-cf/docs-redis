---
title: Enabling Service-Gateway Access
owner: London Services
---

This topic explains how to enable service-gateway access.

## <a id='overview'></a> Overview

Service-gateway access enables a <%= vars.product_full %> on-demand service instance to
connect to external components that are not on the same foundation as the service instance.

For a more detailed overview, see [Service-Gateway Access](./service-gateway-access.html).

To enable service-gateway access for an on-demand offering:

1. [Enable TCP routing using the <%= vars.app_runtime_abbr %> tile](#tcp-routing)
2. [Configure the firewall to allow incoming traffic to the TCP router](#configure-firewall)
3. [Configure the load balancer in the IaaS to redirect traffic to the TCP router](#configure-lb)
4. [Create a DNS record that maps to the load balancer](#create-dns-record)
5. [Configure a service-gateway-enabled plan](#configure-service-gateway-plan)

## <a id='tcp-routing'></a> Enable TCP Routing Using the <%= vars.app_runtime_abbr %> Tile

TCP routing is deactivated by default. To enable TCP routing:

1. Go to the Networking tab on the sidebar of the <%= vars.app_runtime_abbr %> tile.
2. Under **TCP routing**, select **Enable**.
3. For TCP routing ports, enter one or more ports to which the load balancer forwards requests. For example, `1024` for a single port or `1024â€“1123` for a range of ports.
![tcp-ports](images/tcp-ports.png)
4. The ports the operator assigns must not overlap with any other application or tile.
5. Apply changes in <%= vars.ops_manager %> for the <%= vars.app_runtime_abbr %> tile to create the TCP router.

## <a id='configure-firewall'></a> Configure the Firewall to Allow Incoming Traffic to the TCP Router

To configure the firewall:

1. Allow incoming traffic to the TCP router VM created in
[Enable TCP Routing Using the <%= vars.app_runtime_abbr %> Tile](#tcp-routing) earlier.
For information about how to do so, see the documentation for your IaaS.

## <a id='configure-lb'></a> Configure the Load Balancer in the IaaS to Redirect Traffic to the TCP Router

To configure the load balancer:

1. Use the IaaS console and the CID that you recorded earlier to find the VM that runs the TCP router.
1. Create an external TCP load balancer that points to the VM running the TCP router.
1. Configure a distinct external port range that does not overlap with any of the following:
    - The port range configured for service-gateway access for other service tiles, such as VMware
    Tanzu SQL with MySQL for VMs.
    - The TCP networking port or port range that you configured in
    [Enable TCP Routing Using the <%= vars.app_runtime_abbr %> Tile](#tcp-routing) earlier.

    For example, if your TCP routing port range is `1024-1123`,
    then your load balancer port range for service gateway must not overlap `1024-1123`.
    <p class="note">
      <strong>Note:</strong> Each <%= vars.product_short %> service instance using service-gateway
      access requires a unique port.
      Ensure that the port range you configured has enough capacity to accommodate all the service
      instances that you need. The start port and the end port are both inclusive.
    </p>
2. Record this port range.

## <a id='create-dns-record'></a> Create a DNS Record That Maps to the Load Balancer

To create a DNS record and prepare to map it:

1. Following the documentation for your IaaS, create a new DNS record of type A that maps to the
external IP address of the load balancer created in [Configure the Load Balancer in the IaaS to Redirect Traffic to the TCP Router](#configure-lb) earlier.
1. Record the domain used for this DNS record.

## <a id='configure-service-gateway-plan'></a> Configure a Service-Gateway-Enabled Plan

To configure a service-gateway-enabled plan:

1. Go to the **On-Demand Service Settings** tab in the Redis tile sidebar.
2. Scroll down to the **Redis Service Gateway Ports Range** section and enter the port range you want. This range must not overlap with TCP Router ports range or the ports for any other tile.
![redis-ports](images/redis-ports.png)
3. Save your changes.
4. Create a new plan for the Redis tile in the **On-Demand Plans** tab.
5. In the new plan, select the **Service Gateway** check box.
![enable-sg](images/enable-sg.png)
6. Save your changes.
7. Go back to **<%= vars.ops_manager %> Installation Dashboard &gt; Review Pending Changes**.
8. Click **Apply Changes** to apply the changes to the <%= vars.product_short %> tile.

<p class="note warning">
  <strong>Warning:</strong> If you already have service instances using service-gateway,
  any changes to this range must include ports that are already assigned to these service instances.
  If the port range does not contain the ports already assigned to service instances,
  upgrading these service instances fails.

  For example, if service-gateway access has the port range <code>1000-1005</code>, and there are service
  instances that correspond to ports <code>1000</code>, <code>1001</code>, and <code>1002</code>, then the new port range must have
  ports <code>1000</code>, <code>1001</code>, and <code>1002</code>.
</p>

## <a id='deactivate-service-gateway-access'></a> Deactivate Service-Gateway Access

<p class="note">
  <strong>Note:</strong> If service-gateway access is deactivated and then re-enabled, app developers must
  create new service keys to obtain a new set of credentials for service-gateway access.
</p>

To deactivate service-gateway access:

1. Navigate to the service plan that you want to deactivate service-gateway access for
and clear the **Service-Gateway** check box.
    <p class="note">
      <strong>Note:</strong> VMware recommends that you change the name or the
      description of the plan to indicate that service-gateway access is deactivated for that plan.
    </p>

1. Go back to **<%= vars.ops_manager %> Installation Dashboard &gt; Review Pending Changes**.

2. Click **Apply Changes** to apply the changes to the <%= vars.product_short %> tile.

## <a id='workflow'></a> Developer Workflow

For instructions for app developers, see
[Create a Service Instance with Service-Gateway Access](./create-service-gateway-instance.html).
